<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í¬ë¬¼ì„  ëŒ€í¬ | Parabola Cannon</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        /* 1. ì „ì²´ í…Œë§ˆ ì„¤ì • (ë°¤í•˜ëŠ˜ ë°°ê²½) */
        body {
            font-family: 'Jua', sans-serif;
            margin: 0; padding: 0;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
            color: #fff;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; overflow: hidden; /* ìŠ¤í¬ë¡¤ ë°©ì§€ */
            user-select: none;
        }

        /* 2. í—¤ë” */
        header {
            width: 100%; padding: 15px 0;
            display: flex; justify-content: center; align-items: center;
            position: relative; z-index: 10;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(5px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .home-btn {
            position: absolute; left: 20px;
            background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.5); color: #fff;
            padding: 8px 15px; border-radius: 20px; cursor: pointer; 
            text-decoration: none; font-size: 1rem; transition: 0.3s;
        }
        .home-btn:hover { background: #fff; color: #1b2735; }
        h1 { margin: 0; font-size: 2rem; color: #f1c40f; text-shadow: 0 0 15px rgba(241, 196, 15, 0.5); }

        /* 3. ë©”ì¸ ê²Œì„ ì»¨í…Œì´ë„ˆ */
        .game-container {
            display: flex; flex-direction: column; align-items: center;
            width: 95%; max-width: 1000px; height: calc(100vh - 80px);
            margin-top: 10px; gap: 15px;
        }

        /* ìº”ë²„ìŠ¤ ì˜ì—­ */
        .canvas-wrapper {
            flex: 2; width: 100%;
            background: rgba(0,0,0,0.3);
            border-radius: 20px; border: 3px solid rgba(241, 196, 15, 0.3);
            box-shadow: 0 0 30px rgba(0,0,0,0.5) inset;
            position: relative; overflow: hidden;
        }
        #gameCanvas { width: 100%; height: 100%; display: block; }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ ì˜ì—­ */
        .control-panel {
            flex: 1; width: 100%; min-height: 200px;
            background: rgba(255,255,255,0.05);
            border-radius: 20px; padding: 20px; box-sizing: border-box;
            display: flex; flex-direction: column; justify-content: space-between;
            border: 2px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }

        /* ëª¨ë“œ ìŠ¤ìœ„ì¹˜ ë²„íŠ¼ */
        .mode-switch {
            display: flex; justify-content: center; gap: 10px; margin-bottom: 15px;
        }
        .mode-btn {
            padding: 8px 16px; border-radius: 20px; border: 2px solid #fff;
            background: transparent; color: #fff; cursor: pointer; font-family: 'Jua'; font-size: 1rem;
            transition: 0.2s; opacity: 0.6;
        }
        .mode-btn.active {
            background: #fff; color: #1b2735; opacity: 1; font-weight: bold;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        .mode-btn:hover { opacity: 1; }

        /* ìˆ˜ì‹ í‘œì‹œ */
        .equation-display {
            font-size: 1.8rem; text-align: center; margin-bottom: 15px;
            color: #3498db; text-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
        }
        .highlight-a { color: #e74c3c; }
        .highlight-p { color: #2ecc71; }
        .highlight-q { color: #9b59b6; }

        /* ìŠ¬ë¼ì´ë” ì»¨íŠ¸ë¡¤ ê·¸ë£¹ */
        .sliders-group {
            display: flex; justify-content: space-around; gap: 20px; flex-wrap: wrap;
        }
        .slider-item {
            display: flex; flex-direction: column; align-items: center; flex: 1; min-width: 120px;
        }
        .slider-label { font-size: 1.2rem; margin-bottom: 5px; }
        input[type=range] {
            width: 100%; cursor: pointer; accent-color: #f1c40f;
        }

        /* ë²„íŠ¼ ê·¸ë£¹ (ë°œì‚¬, ì§€ìš°ê¸°) */
        .action-group {
            display: flex; gap: 10px; margin-top: 15px;
        }
        .fire-btn {
            flex: 3; padding: 15px;
            font-family: 'Jua', sans-serif; font-size: 1.5rem; color: #fff;
            background: linear-gradient(to bottom, #e67e22, #d35400);
            border: none; border-radius: 15px; cursor: pointer;
            box-shadow: 0 5px 0 #a04000; transition: 0.1s;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        .fire-btn:active { transform: translateY(5px); box-shadow: none; }
        .fire-btn:disabled { background: #7f8c8d; cursor: not-allowed; box-shadow: none; opacity: 0.7; }

        .clear-btn {
            flex: 1; padding: 15px; display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            font-family: 'Jua', sans-serif; font-size: 1.2rem; color: #fff;
            background: linear-gradient(to bottom, #7f8c8d, #2c3e50);
            border: none; border-radius: 15px; cursor: pointer;
            box-shadow: 0 5px 0 #34495e; transition: 0.1s;
        }
        .clear-btn:active { transform: translateY(5px); box-shadow: none; }

        /* ê²°ê³¼ ëª¨ë‹¬ */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); justify-content: center; align-items: center; z-index: 100;
        }
        .modal-content {
            background: linear-gradient(135deg, #fff, #f0f0f0);
            padding: 30px 50px; border-radius: 25px; text-align: center; color: #333;
            border: 5px solid #f1c40f; box-shadow: 0 0 50px rgba(241, 196, 15, 0.5);
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal h2 { font-size: 3rem; margin: 0 0 10px 0; }
        .modal p { font-size: 1.5rem; margin-bottom: 20px; }
        .next-btn {
            background: #27ae60; color: white; padding: 10px 30px; border: none;
            border-radius: 20px; font-size: 1.3rem; cursor: pointer; font-family: 'Jua';
            box-shadow: 0 5px 0 #219150; transition: 0.1s;
        }
        .next-btn:active { transform: translateY(5px); box-shadow: none; }
    </style>
</head>
<body>

    <header>
        <a href="../../index.html" class="home-btn">ğŸ  í™ˆ</a>
        <h1>ğŸ’£ í¬ë¬¼ì„  ëŒ€í¬ (Parabola Cannon)</h1>
    </header>

    <div class="game-container">
        <div class="canvas-wrapper">
            <canvas id="gameCanvas"></canvas>
        </div>

        <div class="control-panel">
            <div class="mode-switch">
                <button class="mode-btn active" id="btnGameMode" onclick="setMode('game')">ğŸ¯ ê²Œì„ ëª¨ë“œ</button>
                <button class="mode-btn" id="btnLabMode" onclick="setMode('lab')">ğŸ”¬ ì‹¤í—˜ì‹¤ ëª¨ë“œ</button>
            </div>

            <div class="equation-display">
                y = <span class="highlight-a" id="valA">-0.5</span>(x - <span class="highlight-p" id="valP">5</span>)Â² + <span class="highlight-q" id="valQ">10</span>
            </div>
            
            <div class="sliders-group">
                <div class="slider-item">
                    <label class="slider-label highlight-a" for="rangeA">ê¸°ìš¸ê¸°(a): <span id="dispA">-0.5</span></label>
                    <input type="range" id="rangeA" min="-2.0" max="2.0" step="0.1" value="-0.5">
                </div>
                <div class="slider-item">
                    <label class="slider-label highlight-p" for="rangeP">ê°€ë¡œ ì´ë™(p): <span id="dispP">5</span></label>
                    <input type="range" id="rangeP" min="1" max="15" step="0.5" value="5">
                </div>
                <div class="slider-item">
                    <label class="slider-label highlight-q" for="rangeQ">ì„¸ë¡œ ì´ë™(q): <span id="dispQ">10</span></label>
                    <input type="range" id="rangeQ" min="1" max="15" step="0.5" value="10">
                </div>
            </div>

            <div class="action-group">
                <button class="fire-btn" id="fireBtn" onclick="fireCannon()">ğŸ”¥ ë°œì‚¬! (Fire)</button>
                <button class="clear-btn" id="clearBtn" onclick="clearTrails()">ğŸ§¹ ì§€ìš°ê¸°</button>
            </div>
        </div>
    </div>

    <div class="modal" id="resultModal">
        <div class="modal-content">
            <h2>ëª…ì¤‘! ğŸ¯</h2>
            <p>ì™„ë²½í•œ í¬ë¬¼ì„ ì…ë‹ˆë‹¤!</p>
            <button class="next-btn" onclick="nextLevel()">ë‹¤ìŒ ëª©í‘œë¬¼ ğŸ‘‰</button>
        </div>
    </div>
    <div class="modal" id="failModal" style="background: rgba(0,0,0,0.6);">
        <div class="modal-content" style="border-color: #c0392b; color: #c0392b;">
            <h2>ë¹—ë‚˜ê°”ë‹¤... ğŸ˜“</h2>
            <p>ìˆ˜ì‹ì„ ë‹¤ì‹œ ìƒê°í•´ë³´ì!</p>
            <button class="next-btn" style="background:#c0392b; box-shadow:0 5px 0 #962e22;" onclick="closeModal()">ì¬ë„ì „ ğŸ’ª</button>
        </div>
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // ê²Œì„ ìƒíƒœ ë³€ìˆ˜
    let currentMode = 'game'; // 'game' or 'lab'
    let gameState = 'aiming'; // 'aiming', 'firing', 'exploding', 'hit', 'miss'
    
    let params = { a: -0.5, p: 5, q: 10 };
    let target = { x: 0, y: 0, radius: 15 };
    let ball = { x: 0, y: 0, radius: 8 };
    
    // ì‹¤í—˜ì‹¤ ëª¨ë“œ ì „ìš© ë³€ìˆ˜ (ê¶¤ì  ì €ì¥)
    let trails = []; // {a, p, q, color} ì €ì¥

    // í­ë°œ íš¨ê³¼
    let particles = [];
    let explosionTimer = 0;

    let canvasWidth, canvasHeight;
    let originX, originY;
    const SCALE = 30;

    // DOM ìš”ì†Œ
    const rangeA = document.getElementById('rangeA');
    const rangeP = document.getElementById('rangeP');
    const rangeQ = document.getElementById('rangeQ');
    const valA = document.getElementById('valA');
    const valP = document.getElementById('valP');
    const valQ = document.getElementById('valQ');
    const dispA = document.getElementById('dispA');
    const dispP = document.getElementById('dispP');
    const dispQ = document.getElementById('dispQ');
    const fireBtn = document.getElementById('fireBtn');
    const clearBtn = document.getElementById('clearBtn');
    const btnGameMode = document.getElementById('btnGameMode');
    const btnLabMode = document.getElementById('btnLabMode');

    function init() {
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        rangeA.addEventListener('input', updateParams);
        rangeP.addEventListener('input', updateParams);
        rangeQ.addEventListener('input', updateParams);

        setMode('game'); // ì´ˆê¸° ëª¨ë“œ
        gameLoop();
    }

    function setMode(mode) {
        currentMode = mode;
        gameState = 'aiming';
        
        // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
        if(mode === 'game') {
            btnGameMode.classList.add('active');
            btnLabMode.classList.remove('active');
            clearBtn.style.display = 'none'; // ì§€ìš°ê¸° ë²„íŠ¼ ìˆ¨ê¹€
            nextLevel(); // ê²Œì„ ì´ˆê¸°í™”
        } else {
            btnGameMode.classList.remove('active');
            btnLabMode.classList.add('active');
            clearBtn.style.display = 'block'; // ì§€ìš°ê¸° ë²„íŠ¼ í‘œì‹œ
            trails = []; // ê¸°ì¡´ ê¶¤ì  ì´ˆê¸°í™”
            ball.x = 0;
            ball.y = getParabolaY(ball.x);
        }
        
        // ëª¨ë‹¬ ë‹«ê¸°
        document.getElementById('resultModal').style.display = 'none';
        document.getElementById('failModal').style.display = 'none';
        fireBtn.disabled = false;
    }

    function resizeCanvas() {
        canvasWidth = canvas.parentElement.clientWidth;
        canvasHeight = canvas.parentElement.clientHeight;
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;
        originX = 50;
        originY = canvasHeight - 50;
        draw();
    }

    function updateParams() {
        if (gameState !== 'aiming' && currentMode === 'game') return; // ê²Œì„ ì¤‘ì—” ì¡°ì‘ ë¶ˆê°€
        
        params.a = parseFloat(rangeA.value);
        params.p = parseFloat(rangeP.value);
        params.q = parseFloat(rangeQ.value);

        valA.textContent = params.a.toFixed(1);
        valP.textContent = params.p.toFixed(1);
        valQ.textContent = params.q.toFixed(1);
        dispA.textContent = params.a.toFixed(1);
        dispP.textContent = params.p.toFixed(1);
        dispQ.textContent = params.q.toFixed(1);
        
        // ì‹¤í—˜ì‹¤ ëª¨ë“œë©´ ê³µ ìœ„ì¹˜ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
        if (currentMode === 'lab' && gameState === 'aiming') {
             ball.x = 0;
             ball.y = getParabolaY(ball.x);
        }
    }

    function nextLevel() {
        if(currentMode !== 'game') return;
        gameState = 'aiming';
        fireBtn.disabled = false;
        document.getElementById('resultModal').style.display = 'none';
        document.getElementById('failModal').style.display = 'none';
        particles = [];
        
        target.x = Math.random() * 13 + 5;
        target.y = Math.random() * 10 + 2;
        ball.x = 0;
        ball.y = getParabolaY(ball.x);
    }

    function closeModal() {
        gameState = 'aiming';
        fireBtn.disabled = false;
        document.getElementById('failModal').style.display = 'none';
        ball.x = 0;
        ball.y = getParabolaY(ball.x);
    }

    function clearTrails() {
        trails = [];
    }

    function getParabolaY(x, p = params) {
        return p.a * Math.pow((x - p.p), 2) + p.q;
    }

    function toCanvasCoord(x, y) {
        return {
            cx: originX + x * SCALE,
            cy: originY - y * SCALE
        };
    }

    function fireCannon() {
        // ì‹¤í—˜ì‹¤ ëª¨ë“œë©´ ë°œì‚¬ ì‹œ í˜„ì¬ ê¶¤ì ì„ ê¸°ë¡ì— ì €ì¥
        if (currentMode === 'lab') {
            trails.push({ ...params, color: `rgba(52, 152, 219, 0.4)` });
        }

        if (gameState !== 'aiming') {
            // ì´ë¯¸ ë°œì‚¬ ì¤‘ì´ë©´ ë¦¬ì…‹í•˜ê³  ë‹¤ì‹œ ë°œì‚¬ (ì‹¤í—˜ì‹¤ ëª¨ë“œ í¸ì˜ì„±)
            if(currentMode === 'lab') {
                ball.x = 0;
                gameState = 'firing';
                return;
            }
            return;
        }

        gameState = 'firing';
        if(currentMode === 'game') fireBtn.disabled = true;
        ball.x = 0;
    }

    function gameLoop() {
        update();
        draw();
        requestAnimationFrame(gameLoop);
    }

    function update() {
        if (gameState === 'firing') {
            ball.x += 0.2; // ê³µ ì†ë„
            ball.y = getParabolaY(ball.x);

            // ê²Œì„ ëª¨ë“œì¼ ë•Œë§Œ ì¶©ëŒ ì²´í¬
            if (currentMode === 'game') {
                const dist = Math.hypot(ball.x - target.x, ball.y - target.y);
                if (dist < (ball.radius + target.radius) / SCALE * 0.8 ) {
                    gameState = 'exploding';
                    createExplosion(ball.x, ball.y);
                }
            }

            // í™”ë©´ ë°– ì²˜ë¦¬
            const ballCanvasPos = toCanvasCoord(ball.x, ball.y);
            if (ballCanvasPos.cy > canvasHeight + 50 || ballCanvasPos.cx > canvasWidth + 50 || ballCanvasPos.cy < -500) {
                if (currentMode === 'game') {
                    gameState = 'miss';
                    document.getElementById('failModal').style.display = 'flex';
                } else {
                    // ì‹¤í—˜ì‹¤ ëª¨ë“œëŠ” ê·¸ëƒ¥ ë¦¬ì…‹
                    gameState = 'aiming';
                    ball.x = 0;
                    ball.y = getParabolaY(ball.x);
                }
            }
        } else if (gameState === 'exploding') {
            updateExplosion();
        }
    }

    function createExplosion(x, y) {
        const pos = toCanvasCoord(x, y);
        for (let i = 0; i < 30; i++) {
            particles.push({
                x: pos.cx, y: pos.cy,
                vx: (Math.random() - 0.5) * 10,
                vy: (Math.random() - 0.5) * 10,
                alpha: 1, color: `hsl(${Math.random()*60 + 10}, 100%, 60%)`
            });
        }
        explosionTimer = 60;
    }

    function updateExplosion() {
        particles.forEach(p => {
            p.x += p.vx; p.y += p.vy;
            p.vy += 0.2;
            p.alpha -= 0.03;
        });
        particles = particles.filter(p => p.alpha > 0);
        explosionTimer--;

        if (explosionTimer <= 0) {
            gameState = 'hit';
            document.getElementById('resultModal').style.display = 'flex';
        }
    }

    function draw() {
        ctx.clearRect(0, 0, canvasWidth, canvasHeight);

        drawAxes();

        // ê²Œì„ ëª¨ë“œì¼ ë•Œë§Œ íƒ€ê²Ÿ ê·¸ë¦¬ê¸°
        if (currentMode === 'game') {
            drawTarget();
        } else {
            // ì‹¤í—˜ì‹¤ ëª¨ë“œì¼ ë•Œ ê¶¤ì (Ghost Trails) ê·¸ë¦¬ê¸°
            drawTrails();
        }

        drawCannon();
        
        // ê³µ ê·¸ë¦¬ê¸° (ë°œì‚¬ ì¤‘ì´ê±°ë‚˜, ì‹¤í—˜ì‹¤ ëª¨ë“œ ì—ì´ë° ì¤‘ì¼ ë•Œ)
        if (gameState === 'firing' || (currentMode === 'lab' && gameState === 'aiming')) {
            drawBall();
        }
        
        if (gameState === 'exploding') drawExplosion();
    }

    function drawTrails() {
        trails.forEach(t => {
            ctx.beginPath();
            ctx.strokeStyle = t.color;
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]); // ì ì„ 

            let started = false;
            // í™”ë©´ ë²”ìœ„ ë‚´ì—ì„œë§Œ ê·¸ë¦¼
            for (let x = 0; x <= 30; x += 0.5) {
                const y = getParabolaY(x, t);
                const pos = toCanvasCoord(x, y);
                
                // í™”ë©´ ë°–ìœ¼ë¡œ ë„ˆë¬´ ë‚˜ê°€ë©´ ê·¸ë¦¬ê¸° ì¤‘ë‹¨ (ì„±ëŠ¥ ìµœì í™”)
                if (pos.cy < -100 || pos.cy > canvasHeight + 100) continue;

                if (!started) { ctx.moveTo(pos.cx, pos.cy); started = true; }
                else { ctx.lineTo(pos.cx, pos.cy); }
            }
            ctx.stroke();
        });
        ctx.setLineDash([]); // ì ì„  ì´ˆê¸°í™”
    }

    function drawAxes() {
        ctx.beginPath();
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.6)';
        ctx.lineWidth = 2;
        // Xì¶•
        ctx.moveTo(0, originY); ctx.lineTo(canvasWidth, originY);
        ctx.lineTo(canvasWidth - 10, originY - 5); ctx.moveTo(canvasWidth, originY); ctx.lineTo(canvasWidth - 10, originY + 5);

        // Yì¶•
        ctx.moveTo(originX, canvasHeight); ctx.lineTo(originX, 0);
        ctx.lineTo(originX - 5, 10); ctx.moveTo(originX, 0); ctx.lineTo(originX + 5, 10);
        ctx.stroke();
        
        ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
        ctx.font = 'bold 16px sans-serif';
        ctx.fillText('O', originX - 20, originY + 25);
        ctx.fillText('x', canvasWidth - 20, originY + 25);
        ctx.fillText('y', originX + 15, 20);
    }

    function drawCannon() {
        const startPos = toCanvasCoord(0, getParabolaY(0));
        ctx.save();
        ctx.translate(startPos.cx, startPos.cy);
        const slope = -2 * params.a * params.p;
        const angle = Math.atan(slope);
        ctx.rotate(-angle);

        ctx.fillStyle = '#7f8c8d';
        ctx.fillRect(-10, -15, 40, 30);
        ctx.fillStyle = '#95a5a6';
        ctx.beginPath(); ctx.arc(0, 0, 20, 0, Math.PI*2); ctx.fill();

        ctx.restore();
    }

    function drawTarget() {
        if (gameState === 'exploding' || gameState === 'hit') return;

        const pos = toCanvasCoord(target.x, target.y);
        const gradient = ctx.createRadialGradient(pos.cx, pos.cy, 5, pos.cx, pos.cy, target.radius + 10);
        gradient.addColorStop(0, '#e74c3c');
        gradient.addColorStop(0.5, '#c0392b');
        gradient.addColorStop(1, 'rgba(231, 76, 60, 0)');
        
        ctx.beginPath(); ctx.arc(pos.cx, pos.cy, target.radius + 10, 0, Math.PI * 2);
        ctx.fillStyle = gradient; ctx.fill();

        ctx.beginPath(); ctx.arc(pos.cx, pos.cy, target.radius, 0, Math.PI * 2);
        ctx.fillStyle = '#e74c3c'; ctx.fill();
        ctx.strokeStyle = '#fff'; ctx.lineWidth = 3; ctx.stroke();
        
        ctx.beginPath(); ctx.arc(pos.cx, pos.cy, target.radius*0.6, 0, Math.PI*2); ctx.strokeStyle='white'; ctx.stroke();
        ctx.beginPath(); ctx.arc(pos.cx, pos.cy, target.radius*0.3, 0, Math.PI*2); ctx.fillStyle='white'; ctx.fill();
    }

    function drawExplosion() {
        particles.forEach(p => {
            ctx.save();
            ctx.globalAlpha = p.alpha;
            ctx.fillStyle = p.color;
            ctx.beginPath(); ctx.arc(p.x, p.y, 6, 0, Math.PI*2); ctx.fill();
            ctx.restore();
        });
    }

    function drawBall() {
        const pos = toCanvasCoord(ball.x, ball.y);
        ctx.beginPath(); ctx.arc(pos.cx, pos.cy, ball.radius, 0, Math.PI * 2);
        ctx.fillStyle = '#f1c40f'; ctx.fill();
        
        ctx.shadowBlur = 20; ctx.shadowColor = '#e67e22';
        ctx.beginPath(); ctx.arc(pos.cx, pos.cy, ball.radius + 2, 0, Math.PI*2);
        ctx.strokeStyle = '#e67e22'; ctx.lineWidth = 2; ctx.stroke();
        ctx.shadowBlur = 0;
    }
    
    init();

</script>
</body>
</html>
